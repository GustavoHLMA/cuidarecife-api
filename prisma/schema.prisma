generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                    String                 @id @default(cuid())
  name                  String
  email                 String                 @unique
  password              String
  neighborhood          String? // Bairro do usuário para filtrar farmácias próximas
  refreshToken          String?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  glucoseReadings       GlucoseReading[]
  bloodPressureReadings BloodPressureReading[]
  prescriptions         Prescription[]
}

model GlucoseReading {
  id          String   @id @default(cuid())
  value       Int // mg/dL
  measuredAt  DateTime
  mealContext String? // "before" | "after" | null
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(now())
}

model BloodPressureReading {
  id         String   @id @default(cuid())
  systolic   Int // pressão sistólica (alta)
  diastolic  Int // pressão diastólica (baixa)
  measuredAt DateTime
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  createdAt  DateTime @default(now())
}

model Prescription {
  id           String       @id @default(cuid())
  patientName  String?
  returnInDays Int?
  userId       String
  user         User         @relation(fields: [userId], references: [id])
  medications  Medication[]
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
}

model Medication {
  id             String       @id @default(cuid())
  name           String
  dosage         String? // Ex: "50mg", "500mg"
  instructions   String // Ex: "Tomar após café da manhã"
  timesPerDay    Int          @default(1) // Quantas vezes ao dia
  times          String? // JSON array de horários: '["08:00", "20:00"]'
  isFree         Boolean      @default(true)
  prescriptionId String
  prescription   Prescription @relation(fields: [prescriptionId], references: [id], onDelete: Cascade)
  doseLogs       DoseLog[]
  createdAt      DateTime     @default(now())
}

model DoseLog {
  id            String     @id @default(cuid())
  medicationId  String
  medication    Medication @relation(fields: [medicationId], references: [id], onDelete: Cascade)
  scheduledTime String? // Horário planejado: "08:00"
  status        String     @default("taken") // "taken" ou "forgotten"
  takenAt       DateTime // Quando realmente tomou/registrou
  createdAt     DateTime   @default(now())
}

model Pharmacy {
  id           String   @id @default(cuid())
  cnpj         String   @unique
  name         String // Nome fantasia ou razão social
  street       String
  number       String?
  complement   String?
  neighborhood String
  cep          String?
  phone        String?
  latitude     Float? // Coordenada para cálculo de distância
  longitude    Float? // Coordenada para cálculo de distância
  createdAt    DateTime @default(now())
}
